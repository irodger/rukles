$.when($.getJSON("js/bd.json?ver=1",function(e){var t=0,n=[],o=[],a=[];$.each(e.body,function(e,o){t+=1,n.push("<li class='"+o.filter+"'><input type='checkbox' id='b"+t+"' value='"+o.name+"' checked> <label for='b"+t+"'>"+o.name+"</label></li>")}),$.each(e.race,function(e,n){t+=1,o.push("<li class='"+n.filter+"'><input type='checkbox' id='c"+t+"' value='"+n.name+"' checked> <label for='c"+t+"' title='"+n.desc+"'>"+n.name+"</label></li>")}),$.each(e.position,function(e,n){t+=1,a.push("<li class='"+n.filter+"'><input type='checkbox' id='d"+t+"' value='"+n.name+"' checked> <label for='d"+t+"'>"+n.name+"</label></li>")}),$(".setup-inputs ul.body").html(n.join("")),$(".setup-inputs ul.type").html(o.join("")),$(".setup-inputs ul.position").html(a.join(""))})).then(function(){var e=function(e){var o,a,t=decodeURIComponent(window.location.search.substring(1)),n=t.split("&");for(a=0;a<n.length;a++)if(o=n[a].split("="),o[0]===e)return void 0===o[1]?!0:o[1]},t=e("f");if(" "!==t){var n=".sortby>li."+t;$(n).addClass("active").siblings().removeClass("active")}var o=$(".sortby>li.active").attr("class"),a=o.replace(/active|(\s)/gi,"");"all"!==a?(o="."+a,$(".setup-inputs ul li :checkbox").removeAttr("checked").parents(o).children(":checkbox").prop("checked",!0)):$(".setup-inputs ul li :checkbox").attr("checked",!0).prop("checked",!0);var i=$(".position").find("li :checkbox").length,l=$(".type").find("li :checkbox").length,s=$(".body").find("li :checkbox").length,c=$(".position"),r=$(".type"),h=$(".body"),d=$(".btn.rukles"),u=$(".btn.blots"),p=$("#result"),f=$(".inhelp"),v=function(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g," ")},m=i*l*s;$(".srow").text(i),$(".trow").text(l),$(".forow").text(s),$(".howmuch").text(v(m));var k=c.find("li :checkbox:checked").eq(Math.floor(Math.random()*c.find("li :checkbox:checked").length)).val(),b=r.find("li :checkbox:checked").eq(Math.floor(Math.random()*r.find("li :checkbox:checked").length)),g="<span class='help-link' data-toggle='tooltip' data-placement='top' title='"+b.next("label").attr("title")+"' >"+b.val()+"</span> ",C=h.find("li :checkbox:checked").eq(Math.floor(Math.random()*h.find("li :checkbox:checked").length)).val()+" ",x=C+g+k;f.html(x),p.html("<p>"+x+"</p>"),$("span.help-link").tooltip(),$(".sel-row").on("change click",function(){$(this).prop("checked")?$(this).parents().next("ul").children().children().prop("checked",!0):$(this).parents().next("ul").children().children().removeAttr("checked")}),$(".sortby li").on("click",function(){$(this).addClass("active").siblings().removeClass("active");var e=$(this).attr("class");e="."+e.replace(/active/g,""),$(this).hasClass("all")?$(".setup-inputs ul li :checkbox").prop("checked",!0):$(".setup-inputs ul li :checkbox").removeAttr("checked").parents(e).children(":checkbox").prop("checked",!0)});var w=function(){var e=c.find("li :checkbox:checked").length,t=r.find("li :checkbox:checked").length,n=h.find("li :checkbox:checked").length,o=function(e){var t="";return e.parent("li").hasClass("magic")?t="magic":e.parent("li").hasClass("epic")?t="epic":e.parent("li").hasClass("legend")?t="legend":e.parent("li").hasClass("unusual")?t="unusual":e.parent("li").hasClass("magic")?t="magic":e.parent("li").hasClass("epic")&&e.parent("li").hasClass("unusual")&&e.parent("li").hasClass("magic")&&e.parent("li").hasClass("legend")||(t="common"),"<span class='attr' data-status='"+t+"'>"+e.val()+"</span> "};if(n>1)var a=Math.floor(Math.random()*n),i=h.find("li :checkbox:checked").eq(a),l=o(i);else if(1===n)var i=h.find("li :checkbox:checked"),l=o(i);else var l="";if(t>1)var s=Math.floor(Math.random()*t),d=r.find("li :checkbox:checked").eq(s),u="<span class='help-link' data-toggle='tooltip' data-placement='top' title='"+d.next("label").attr("title")+"' >"+d.val()+"</span>";else if(1===t)var d=r.find("li :checkbox:checked"),u="<span class='help-link' data-toggle='tooltip' data-placement='top' title='"+d.next("label").attr("title")+"' >"+d.val()+"</span>";else var u="";if(e>1)var p=Math.floor(Math.random()*e),f=" "+c.find("li :checkbox:checked").eq(p).val();else if(1===e)var f=" "+c.find("li :checkbox:checked").val();else var f="";return res=l+u+f,res},y=function(){$(".can-blot").children().each(function(){var e="img/blot-"+Math.floor(8*Math.random())+".svg";$(this).attr("src",e)}),$(".can-blot").each(function(){var e=["0deg","180deg"],t="rotateY("+e[Math.floor(Math.random()*e.length)]+")",n="rotateX("+e[Math.floor(Math.random()*e.length)]+")",o="rotate("+Math.floor(360*Math.random())+"deg) "+t+" "+n;$(this).css({transform:o})});var e=$(".blot-1"),t=$(".blot-2"),n=$(".blot-3"),a=($(".blot-4"),$(".blot-5")),i=e.css("left"),l=t.css("left"),s=n.css("top"),c=a.css("top");e.css({left:l}),t.css({left:i}),n.css({top:c}),a.css({top:s})};$(document).ready(function(){y()}),u.on("click",function(e){e.preventDefault(),y(),$(".blot-cont").addClass("anim--hurricane"),setTimeout(function(){$(".blot-cont").removeClass("anim--hurricane")},1500),dataLayer.push({event:"GAevent",eventCategory:"Generation",eventAction:"ClickBlotBtn",eventLabel:"BltBtn"})}),d.on("touchstart",function(){$(this).addClass("touched")}).on("touchend",function(){$(this).removeClass("touched")}),$(".blot").on("touchstart",function(){$(this).addClass("touched")}).on("touchend",function(){$(this).removeClass("touched")}),d.on("click",function(e){e.preventDefault(),d.removeClass("rukles").addClass("btn-fill"),p.removeClass("anim--grow epic magic legend unusual common").addClass("gone");var t=parseInt($(".howTime").val()),n=[],o=0;for(t=(""!==t||t>0)&&101>t?t:t>100?100:1;t>o;)n.push("<p>"+w()+"</p>"),o++;setTimeout(function(){p.html(n).removeClass("gone").addClass("anim--grow").css("opacity","1"),$("span.help-link").tooltip(),$("#result p").each(function(){var e=$(this).children("span.attr").data("status");$(this).addClass(e)})},800),setTimeout(function(){d.removeClass("btn-fill").addClass("rukles")},1e3)});var M=document.location.hash,T="tab_",B=$(".popup-overlay"),I=$(".absolute-settings");M&&$(".ru-tabs a[href="+M.replace(T,"")+"]").tab("show"),$(".ru-tabs a").on("shown",function(e){window.location.hash=e.target.hash.replace("#","#"+T)}),$(".glyphicon-cog.setup").on("click",function(){I.toggleClass("opened"),B.toggle(),$(this).addClass("spinIt"),setTimeout(function(){$(".glyphicon-cog.setup").removeClass("spinIt")},300)}),B.on("click",function(){I.hasClass("opened")?(I.removeClass("opened"),B.hide()):$("#hist").hasClass("in")&&($("#hist").removeClass("in"),I.css("z-index","51"),B.hide(),$(".container-fluid,.container").removeClass("blured"))}),$(".blot").on("click",function(){$(this).toggleClass("stopped")}),$("[data-target='#hist']").on("click",function(){$("#hist.collapse").hasClass("in")?(I.css("z-index","51"),B.hide(),$(".container-fluid,.container").removeClass("blured")):(I.css("z-index","49"),B.show(),$(".container-fluid,.container").addClass("blured"))}),"closed"!==Cookies.get("rkls_tutorial")&&($(".tutorial").show(),$(".tut.a").show().siblings().hide()),$(".show-tut").on("click",function(){$(".tutorial").show(),$(".tut.a").show().siblings().hide()}),$(".next-tut").on("click",function(e){e.preventDefault();var t=$(this).parents(".tut").attr("class");t="."+t.replace(/tut|(\s)/gi,"");var n=$(this).parents(t).hide().next().show(),o=$(n).offset().top;$("html,body").animate({scrollTop:o},300)}),$(".close-tut").on("click",function(e){e.preventDefault(),$(".tutorial").hide(),"closed"!==Cookies.get("rkls_tutorial")&&Cookies.set("rkls_tutorial","closed")})});